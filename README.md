[![License: CC BY 3.0](https://img.shields.io/badge/License-CC%20BY%203.0-lightgrey.svg)](https://creativecommons.org/licenses/by/3.0/) [![License: GPL v2](https://img.shields.io/badge/License-GPL%20v2-blue.svg)](https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html)

TTRPG Tools
=================

  * [About](https://github.com/wushin/ttrpg-tools#about)
  * [Prerequisites](https://github.com/wushin/ttrpg-tools#prerequisites)
  * [Initializing](https://github.com/wushin/ttrpg-tools#initializing)
  * [Env file options](https://github.com/wushin/ttrpg-tools#env-file-options)
  * [Destroy env](https://github.com/wushin/ttrpg-tools#destroy-env)
  * [Working in containers](https://github.com/wushin/ttrpg-tools#working-in-containers)

## About
* A easy to install set of Table Top RPG Tools to help DM
  * [Dungeon Revealer](https://github.com/dungeon-revealer/dungeon-revealer) - Uses images to display dungeon and battle maps with fog of war
  * [Improved Initiative](https://github.com/cynicaloptimist/improved-initiative) - Combat tracker for Dungeons and Dragons (D&D) 5th Edition
  * [Paragon](https://github.com/cynicaloptimist/paragon) - Configurable DM screen to use when running a tabletop RPGs
  * [Let's Encrypt](https://letsencrypt.org/) - A free ssl service

## Prerequisites:
* Local Docker Build
  * Docker [Mac Install](https://docs.docker.com/docker-for-mac/install/) [Linux Install](https://docs.docker.com/engine/install/#server)
  * Docker Compose [Mac & Linux Install](https://docs.docker.com/compose/install/)
* AWS Build
  * Terraform [Mac Install](https://learn.hashicorp.com/tutorials/terraform/install-cli) [Linux Install](https://learn.hashicorp.com/tutorials/terraform/install-cli)
  * AWS Cli [Mac Install](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-mac.html) [Linux Install](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html)

## Initializing
* Clone recursively
  * `git clone --recursive` (git 1+)
  * `git clone --recurse-submodules` (git 2+)
* Copy over the .env.sample to .env and configure your settings.
  * See [Env file options](https://github.com/wushin/ttrpg-tools#env-file-options) for options

* Local Build
  * You can build using make, bash or Manually. Only one method needs to be used.
    * Make build
      * `make build`
    * Scripted Build
      * `bash set-up.sh build`
    * Manual Build
      * Build and Bring the docker-compose environment up
        * `sudo docker-compose up -d --build`
      * Then create or update your ssl certs
        * `sudo docker exec nginx bash /var/www/certbot.sh`
  * If you want to use localhost or the machine's IP add entries into your hosts file or DNS. 
    * Example using localhost:
```
127.0.0.1	localhost dungeon-revealer.localdomain improved-initiative.localdomain paragon.localdomain
```
  * Localhost and SSL
    * Let's Encrypt SSL does not work with localhost as Let's Encrypt needs to hit a publically accessiable IP and hostname.
    * The default SSLs generated by nginx can work if you accept them and add them to your browser.

* AWS Build
  * [See Terraform/AWS Readme](https://github.com/wushin/ttrpg-tools/blob/main/README.md)

## Env file options
* `NODE_ENV` - `production` or `development` which Improved Initiative build to use
* `DOMAIN` - The domain all the hosts will bind too
* `DOMAIN_EMAIL` - The Email address Let's Encrypt will notify you when the ssl is about to expire
* `DR_HOST` - The hostname for Dungeon Revealer
* `II_HOST` - The hostname for Improved Initiative
* `PA_HOST` - The hostname for Paragon
* `SSL` - `nossl` to not use ssl and `ssl` to use ssl
* `HTACCESS` - `yes` to set-up auth with separate player and gm password and `no` to not set-up auth
* `HT_USER` - The name the players will use to login
* `DR_USER_PASS` - The password the players will use to login
* `HT_DM_USER` - The name the DM will use to login
* `DR_DM_PASS` - The password the DM will use to login
* `MONGO_INITDB_ROOT_USERNAME` - Name for root user of Mongo db
* `MONGO_INITDB_ROOT_PASSWORD` - Password for root user of Mongo db

## Scripts
* `make install`, `make build`, `bash set-up.sh build`
  * Builds the environment
* `make restart`, `bash set-up.sh restart`
  * Restarts all built containers
* `make ssl`, `bash set-up.sh ssl`
  * Runs the certbot script
* `make destroy`, `bash destroy.sh`
  * This script will prompt you to:
    * Stop all containers
    * Destroy all containers
    * Destroy all Volumes

## Working in containers
* Login to container
  * `sudo docker exec -it [<container_hostname>] bash`
* Get logs of container
  * `sudo docker-compose logs -f [<container_name>]`
* Show all containers
  * `sudo docker-compose ps`
* Build and start containers
  * `sudo docker-compose up -d --build`
* Stop all containers
  * `sudo docker-compose kill`
* Delete inactive containers
  * `sudo docker system prune -a -f`
* Remove volumes
  * `sudo docker volume prune -f`
